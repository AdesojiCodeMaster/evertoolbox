(function(){document.documentElement.setAttribute('data-theme',localStorage.getItem('theme')||((window.matchMedia&&window.matchMedia('(prefers-color-scheme:dark)').matches)?'dark':'light'));document.addEventListener('DOMContentLoaded',function(){var btn=document.getElementById('theme-toggle');if(btn)btn.addEventListener('click',function(){var now=document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark';document.documentElement.setAttribute('data-theme',now);localStorage.setItem('theme',now);});var menuBtn=document.getElementById('mobile-menu-btn');var mobileMenu=document.getElementById('mobile-menu');if(menuBtn&&mobileMenu){menuBtn.addEventListener('click',function(){var open=mobileMenu.classList.toggle('open');menuBtn.setAttribute('aria-expanded',open?'true':'false');mobileMenu.setAttribute('aria-hidden',open?'false':'true');});mobileMenu.querySelectorAll('a').forEach(function(a){a.addEventListener('click',function(){mobileMenu.classList.remove('open');menuBtn.setAttribute('aria-expanded','false');});});}document.querySelectorAll('a[href^="#"]').forEach(function(a){a.addEventListener('click',function(e){var id=this.getAttribute('href').slice(1);var el=document.getElementById(id);if(el){e.preventDefault();el.scrollIntoView({behavior:'smooth',block:'start'});}});});});window.countWords=function(text){if(!text)return{words:0,characters:0};var chars=text.length;var words=text.trim().split(/\s+/).filter(Boolean).length;return{words:words,characters:chars};};window.updateWordCounter=function(){var ta=document.getElementById('wc-input');var out=document.getElementById('wc-output');if(!ta||!out)return;var r=countWords(ta.value);out.innerText=r.words+' words — '+r.characters+' characters';};window.convertCase=function(mode){var ta=document.getElementById('case-input');var out=document.getElementById('case-output');if(!ta||!out)return;var v=ta.value;if(mode==='upper')v=v.toUpperCase();if(mode==='lower')v=v.toLowerCase();if(mode==='title')v=v.replace(/\w\S*/g,function(w){return w.charAt(0).toUpperCase()+w.substr(1).toLowerCase();});out.value=v;};window.synth=window.speechSynthesis;window.populateVoices=function(){var sel=document.getElementById('tts-voices');if(!sel)return;var voices=synth.getVoices();sel.innerHTML='';voices.forEach(function(v,i){var opt=document.createElement('option');opt.value=i;opt.textContent=v.name+' ('+v.lang+')'+(v.default?' — default':'');sel.appendChild(opt);});};if(window.speechSynthesis){populateVoices();window.speechSynthesis.onvoiceschanged=populateVoices;}window.speakText=function(preload){var ta=document.getElementById('tts-input');var sel=document.getElementById('tts-voices');if(!ta||!sel)return;var text=ta.value||(preload?ta.dataset.demo:'');if(!text)return alert('Enter text to speak or choose a demo.');var u=new SpeechSynthesisUtterance(text);var voices=window.speechSynthesis.getVoices();var voice=voices[sel.value]||voices[0];if(voice)u.voice=voice;window.speechSynthesis.cancel();window.speechSynthesis.speak(u);};window.runSeoAnalysis=function(){var title=document.getElementById('seo-title').value||'';var desc=document.getElementById('seo-desc').value||'';var report=document.getElementById('seo-report');if(!report)return;var html='';html+='<p><strong>Title length:</strong>'+title.length+' characters</p>';html+='<p><strong>Meta description length:</strong>'+desc.length+' characters</p>';report.innerHTML=html;};window.downloadText=function(filename,content){var a=document.createElement('a');var blob=new Blob([content],{type:'text/plain'});a.href=URL.createObjectURL(blob);a.download=filename;document.body.appendChild(a);a.click();a.remove();};window.handleTextDownload=function(){var txt=document.getElementById('fc-text').value||'';var name=document.getElementById('fc-name').value||'download.txt';downloadText(name,txt);};window.imageToDataURL=function(file,type,quality,maxW,maxH){return new Promise(function(resolve,reject){var img=new Image();var reader=new FileReader();reader.onload=function(e){img.onload=function(){var canvas=document.createElement('canvas');var w=img.width,h=img.height;var scale=Math.min(maxW?maxW/w:1,maxH?maxH/h:1);if(scale<1){w=Math.round(w*scale);h=Math.round(h*scale);}canvas.width=w;canvas.height=h;var ctx=canvas.getContext('2d');ctx.drawImage(img,0,0,w,h);resolve(canvas.toDataURL(type,quality));};img.onerror=reject;img.src=e.target.result;};reader.onerror=reject;reader.readAsDataURL(file);});};window.handleImageConvert=async function(){var input=document.getElementById('ic-file');var out=document.getElementById('ic-output');if(!input||!out||!input.files[0])return alert('Choose an image first');var type=document.getElementById('ic-format').value;var thumb=document.getElementById('ic-thumb-size').value;var data=await imageToDataURL(input.files[0],type,0.9,parseInt(thumb),parseInt(thumb));out.src=data;var a=document.createElement('a');a.href=data;a.download='converted.'+type.split('/')[1];a.click();};window.LocalZip=window.LocalZip||(function(){return{createZipLike:async function(items){var parts=[];for(var i=0;i<items.length;i++){var it=items[i];var nameBytes=new TextEncoder().encode(it.name);var header=new Uint8Array(4+nameBytes.length);header[0]=nameBytes.length&255;header[1]=nameBytes.length>>8&255;header[2]=0;header[3]=0;parts.push(header.buffer,nameBytes.buffer,it.arrayBuffer);}return new Blob(parts,{type:'application/octet-stream'});} };})();window.handleZipCreate=async function(){var files=document.getElementById('zip-files').files;if(!files.length)return alert('Select files to zip');try{if(window.JSZip&&typeof JSZip==='function'&&JSZip.prototype&&JSZip.prototype.generateAsync){var zip=new JSZip();for(var i=0;i<files.length;i++){var f=files[i];zip.file(f.name,await f.arrayBuffer());}var blob=await zip.generateAsync({type:'blob'});var a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='archive.zip';a.click();return;}if(window.LocalZip&&typeof window.LocalZip.createZipLike==='function'){var items=[];for(var i=0;i<files.length;i++){var f=files[i];items.push({name:f.name,arrayBuffer:await f.arrayBuffer()});}var blob=await window.LocalZip.createZipLike(items);var a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='archive.bundle';a.click();return;}alert('No zip library available.');}catch(err){console.error(err);alert('Failed to create zip: '+err.message);} };